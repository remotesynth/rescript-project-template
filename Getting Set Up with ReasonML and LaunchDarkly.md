# Getting Set Up with ReasonML and LaunchDarkly

[ReasonML](https://reasonml.github.io/) is a programming language that combines JavaScript and OCaml. You can think of it like TypeScript in that it can be used to compile to JavaScript, but with it's type system defined using OCaml. If you're building a frontend application using ReasonML, you'll want to use [ReScript](https://rescript-lang.org/) pr [js_of_ocaml](https://ocsigen.org/js_of_ocaml/) both of which compile to JavaScript. In this tutorial, we'll walk through how to get a project built with ReScript set up to use LaunchDarkly.

## Setting Up LaunchDarkly

If you don't already have one, you'll want to set up a [LaunchDarkly account](https://launchdarkly.com/). Once you do, it'll walk you thorugh the steps for creating your first feature flag. For the purposes of this demo, I've simply named mine "my first feature flag", which will be converted to a slug of `my-first-feature-flag` automatically. We'll need that in a moment to set our project.

ReScript can use npm packages natively, so when LaunchDarkly askes which language, you cna select "Node.js". We'll use these instructions to install the Node SDK on our ReScript project in a moment. For now, we won't get into configuring our feature flag any further.

## Setting Up a ReScript Project

Let's follow the instructions for setting up a new ReScript project locally from [their documentation](https://rescript-lang.org/docs/manual/latest/installation):

```bash
git clone https://github.com/rescript-lang/rescript-project-template
cd rescript-project-template
npm install
npm run build
node src/Demo.bs.js
```

Since this is a new project, this mehtod initializes a new ReScript project based upon a basic template. Next, we'll install the Node SDK for LaunchDarkly:

```bash
npm install launchdarkly-node-server-sdk@6.1.0
```

Now we're ready to start coding in ReScript.

## Initializing LaunchDarkly in ReScript

Our task here is to essentially take the JavaScript code from the [Node.js SDK documentation](https://docs.launchdarkly.com/sdk/server-side/node-js) for initializing your LaunchDarkly client and convert it to ReScript syntax. It's worth noting that you could just copy and paste the code wrapped in `%%raw()` which indicates raw JavaScript, but that would be cheating wouldn't it? ðŸ˜‰

> It's worth running through ReScript's [converting from JS](https://rescript-lang.org/docs/manual/latest/converting-from-js) tutorial if you're new to ReScript as it will help you grasp how to convert code in small chunks.

### Looking At The Code

We will start by loading the LaunchDarkly npm package using ReScript's syntax. Then we create an instance of the client (`ldclient`) by calling the `init()` method and pass in our LaunchDarkly API key.  Next, we'll create a type for a user to pass into the LaunchDarkly client once it is ready. To do so, we'll initialize a [Record type](https://rescript-lang.org/docs/manual/latest/record) definition for a `user` and then an instance of a user type (`me`).

Finally, we intialize the ready event handler for LaunchDarkly that will first log that the client is ready and then set up a variation for this user on our `my-first-feature-flag` flag. This will return `true` our `false` for this user. We then use that to log whether we'd show the feature or hide it.

```javascript
@module external launchDarkly: 'whatever = "launchdarkly-node-server-sdk"
let ldclient = launchDarkly["init"](. "sdk-64fb3f87-7e48-4a8d-99de-595a7472472f")
type user = {key: string}

let me = {
  key: "aa0ceb",
}

ldclient["on"](."ready", () => {
  Js.log("It's now safe to request feature flags")

  let showFeature = ldclient["variation"](. "my-first-feature-flag", me)

  if showFeature {
    Js.log("Show feature")
  } else {
    Js.log("Don't show feature")
  }
})
```

Open `Demo.res` and replace the code with the code shown above.

## Finishing Up

Once our code is ready, we can compile it down to JavaScript. From the console run `npm run build`. We should get a response like:

```bash
> rescript-project-template@0.0.1 build
> rescript

rescript: [3/3] src/Demo.cmj
```

This means it built successfully. If we open the `Demo.bs.js` file that it generated, the output should look like the following:

```javascript
// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var LaunchdarklyNodeServerSdk = require("launchdarkly-node-server-sdk");

var ldclient = LaunchdarklyNodeServerSdk.init("sdk-my-key");

var me = {
  key: "aa0ceb"
};

ldclient.on("ready", (function (param) {
        console.log("It's now safe to request feature flags");
        var showFeature = ldclient.variation("my-first-feature-flag", me);
        if (showFeature) {
          console.log("Show feature");
        } else {
          console.log("Don't show feature");
        }
        
      }));

exports.ldclient = ldclient;
exports.me = me;
/* ldclient Not a pure module */
```

As you can see, this is plain old JavaScript. Finally, we can run this code by running `node src/demo.bs.js` to make sure it works. We should get a response like the following:

```bash
info: [LaunchDarkly] Initializing stream processor to receive feature flag updates
info: [LaunchDarkly] Opened LaunchDarkly stream connection
It's now safe to request feature flags
Show feature
```

We've done it! ðŸŽ‰ In this response, LaunchDarkly has indicated that we should show the feature to the user. Feel free to expand on this code to more deeply integrate LaunchDarkly into your ReScript project.